!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Flat=e()}(this,function(){"use strict";function t(t,e){e.appendChild(t)}function e(t,e,n){e.insertBefore(t,n)}function n(t){t.parentNode.removeChild(t)}function s(t){return document.createElement(t)}function i(t){return document.createTextNode(t)}function r(t){return t?this._state[t]:this._state}function o(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var s=0;s<n.length;s+=1)n[s].call(this,e)}function a(t,e,n){var s=n&&n.defer?this._observers.pre:this._observers.post;return(s[t]||(s[t]=[])).push(e),n&&n.init===!1||(e.__calling=!0,e.call(this,this._state[t]),e.__calling=!1),{cancel:function(){var n=s[t].indexOf(e);~n&&s[t].splice(n,1)}}}function l(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function d(t,e,n,s){for(var i in e)if(i in n){var r=n[i],o=s[i];if(r!==o||"object"==typeof r){var a=e[i];if(a)for(var l=0;l<a.length;l+=1){var d=a[l];d.__calling||(d.__calling=!0,d.call(t,r,o),d.__calling=!1)}}}}function u(r,o){function a(t){o.onclick(t)}var l=s("button");l.addEventListener("click",a,!1),l.className="sf-button sf-button--"+(r.status?r.status:"default"),l.disabled=r.disabled;var d=s("span");t(d,l);var u=i(r.content);return t(u,d),{mount:function(t,n){e(l,t,n)},update:function(t,e){l.className="sf-button sf-button--"+(e.status?e.status:"default"),l.disabled=e.disabled,u.data=e.content},teardown:function(t){l.removeEventListener("click",a,!1),t&&n(l)}}}function h(t){t=t||{},this._state=t.data||{},this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=t._root,this._yield=t._yield,this._fragment=u(this._state,this),t.target&&this._fragment.mount(t.target,null)}function c(t,i){function r(t){i.onfocus(t)}var o=s("input");return o.addEventListener("focus",r,!1),o.className="sf-input sf-input--"+(t.status?t.status:"default"),o.placeholder=t.placeholder?t.placeholder:"",o.type=t.type?t.type:"text",o.disabled=t.disabled,o.value=t.value?t.value:"",{mount:function(t,n){e(o,t,n)},update:function(t,e){o.className="sf-input sf-input--"+(e.status?e.status:"default"),o.placeholder=e.placeholder?e.placeholder:"",o.type=e.type?e.type:"text",o.disabled=e.disabled,o.value=e.value?e.value:""},teardown:function(t){o.removeEventListener("focus",r,!1),t&&n(o)}}}function f(t){t=t||{},this._state=t.data||{},this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=t._root,this._yield=t._yield,this._fragment=c(this._state,this),t.target&&this._fragment.mount(t.target,null)}function p(r,o){function a(t){o.onButtonDown(t)}function l(t){o.onDragEnd(t)}var d=s("div");o.refs.slider=d,d.className="sf-slider";var u=s("div");o.refs.range=u,u.className="sf-slider__range",u.style.cssText="width: "+(r.value?r.value:0)+"%",t(u,d),t(i("\n  "),d);var h=s("span");return h.className="sf-slider__handle",h.style.cssText="left: "+(r.value?r.value:0)+"%",h.addEventListener("mousedown",a,!1),h.addEventListener("mouseup",l,!1),t(h,d),{mount:function(t,n){e(d,t,n)},update:function(t,e){u.style.cssText="width: "+(e.value?e.value:0)+"%",h.style.cssText="left: "+(e.value?e.value:0)+"%"},teardown:function(t){o.refs.slider===d&&(o.refs.slider=null),o.refs.range===u&&(o.refs.range=null),h.removeEventListener("mousedown",a,!1),h.removeEventListener("mouseup",l,!1),t&&n(d)}}}function v(t){t=t||{},this.refs={},this._state=Object.assign(b.data(),t.data),this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=t._root,this._yield=t._yield,this._fragment=p(this._state,this),t.target&&this._fragment.mount(t.target,null)}function g(r,o){function a(t){o.handleTimeupdate()}function l(t){o.togglePlay()}var d=s("div");d.className="sf-video",d.style.cssText="width: "+r.width+"px; height: "+r.height+"px;";var u=s("video");o.refs.video=u,u.preload=!0,u.width=r.width,u.height=r.height,u.src=r.src,u.loop=r.loop,u.addEventListener("timeupdate",a,!1),t(u,d),t(i("\n  "),d);var h=s("div");h.className="sf-video-controls",t(h,d);var c=s("label");c.className="sf-video-controls--play",t(c,h);var f=s("input");o.refs.togglePlay=f,f.type="checkbox",f.addEventListener("change",l,!1),t(f,c),t(i("\n      "),c);var p=s("span");t(p,c),t(i("\n\n    "),h);var v=s("div");v.className="sf-video-controls--progress",t(v,h);var g=s("div");return g.id="sf-video-controls--progress",t(g,v),{mount:function(t,n){e(d,t,n)},update:function(t,e){d.style.cssText="width: "+e.width+"px; height: "+e.height+"px;",u.width=e.width,u.height=e.height,u.src=e.src,u.loop=e.loop},teardown:function(t){o.refs.video===u&&(o.refs.video=null),u.removeEventListener("timeupdate",a,!1),o.refs.togglePlay===f&&(o.refs.togglePlay=null),f.removeEventListener("change",l,!1),t&&n(d)}}}function _(t){t=t||{},this.refs={},this._state=Object.assign(w.data(),t.data),this._observers={pre:Object.create(null),post:Object.create(null)},this._handlers=Object.create(null),this._root=t._root,this._yield=t._yield,this._fragment=g(this._state,this),t.target&&this._fragment.mount(t.target,null),t._root?t._root._renderHooks.push({fn:w.onrender,context:this}):w.onrender.call(this)}var m=function(){return{methods:{onclick:function(t){}}}}();h.prototype=m.methods,h.prototype.get=r,h.prototype.fire=o,h.prototype.observe=a,h.prototype.on=l,h.prototype.set=function(t){var e=this._state;this._state=Object.assign({},e,t),d(this,this._observers.pre,t,e),this._fragment&&this._fragment.update(t,this._state),d(this,this._observers.post,t,e)},h.prototype.teardown=function(t){this.fire("teardown"),this._fragment.teardown(t!==!1),this._fragment=null,this._state={}};var y=function(){return{methods:{onfocus:function(t){}}}}();f.prototype=y.methods,f.prototype.get=r,f.prototype.fire=o,f.prototype.observe=a,f.prototype.on=l,f.prototype.set=function(t){var e=this._state;this._state=Object.assign({},e,t),d(this,this._observers.pre,t,e),this._fragment&&this._fragment.update(t,this._state),d(this,this._observers.post,t,e)},f.prototype.teardown=function(t){this.fire("teardown"),this._fragment.teardown(t!==!1),this._fragment=null,this._state={}};var b=function(){return{data:function(){return{width:0,offset:0,dragging:!1}},methods:{onButtonDown:function(t){this.onDragStart(t),window.addEventListener("mousemove",this.onDragging.bind(this)),window.addEventListener("mouseup",this.onDragEnd.bind(this)),window.addEventListener("contextmenu",this.onDragEnd.bind(this))},onDragStart:function(t){var e=this.refs.slider,n=this.refs.range;this.set({width:e.clientWidth,offset:t.clientX-n.clientWidth,dragging:!0})},onDragging:function(t){if(this.get("dragging")){var e=(t.clientX,this.get("width")),n=this.get("offset"),s=t.clientX-n,i=parseInt(s/e*100);i>100&&(i=100),i<0&&(i=0),this.set({value:i})}},onDragEnd:function(){this.get("dragging")&&(this.set({dragging:!1}),window.removeEventListener("mousemove",this.onDragging),window.removeEventListener("mouseup",this.onDragEnd),window.removeEventListener("contextmenu",this.onDragEnd))}}}}();v.prototype=b.methods,v.prototype.get=r,v.prototype.fire=o,v.prototype.observe=a,v.prototype.on=l,v.prototype.set=function(t){var e=this._state;this._state=Object.assign({},e,t),d(this,this._observers.pre,t,e),this._fragment&&this._fragment.update(t,this._state),d(this,this._observers.post,t,e)},v.prototype.teardown=function(t){this.fire("teardown"),this._fragment.teardown(t!==!1),this._fragment=null,this._state={}};var w=function(){return{data:function(){return{slider:null}},onrender:function(){var t=this.refs.video,e=this.refs.togglePlay;t.onended=function(){e.checked=!1};var n=new v({target:document.querySelector("#sf-video-controls--progress"),value:0});this.set({slider:n})},methods:{togglePlay:function(){var t=this.refs.video;t.paused?t.play():t.pause()},handleTimeupdate:function(){var t=this.refs.video,e=parseInt(t.currentTime/t.duration*100),n=this.get("slider");n.set({value:e})}},components:{Slider:v}}}();_.prototype=w.methods,_.prototype.get=r,_.prototype.fire=o,_.prototype.observe=a,_.prototype.on=l,_.prototype.set=function(t){var e=this._state;this._state=Object.assign({},e,t),d(this,this._observers.pre,t,e),this._fragment&&this._fragment.update(t,this._state),d(this,this._observers.post,t,e)},_.prototype.teardown=function(t){this.fire("teardown"),this._fragment.teardown(t!==!1),this._fragment=null,this._state={}};var E={Button:h,Input:f,Video:_,Slider:v};return E});
